export class Utils{static init(){window.addEventListener("error",t=>{console.error("Global error:",t.error)}),window.addEventListener("unhandledrejection",t=>{console.error("Unhandled promise rejection:",t.reason)})}static debounce(t,e,r=!1){let o;return function(...n){const a=r&&!o;clearTimeout(o),o=setTimeout(()=>{o=null,r||t(...n)},e),a&&t(...n)}}static throttle(t,e){let r;return function(...o){r||(t.apply(this,o),r=!0,setTimeout(()=>r=!1,e))}}static getFormData(t){const e=document.getElementById(t);if(!e)return{};const r=new FormData(e),o={};for(const[t,e]of r.entries())o[t]=e;return o}static setFormData(t,e){const r=document.getElementById(t);r&&Object.keys(e).forEach(t=>{const o=r.elements[t];if(o)if("checkbox"===o.type)o.checked=e[t];else if("radio"===o.type){const o=r.querySelector(`input[name="${t}"][value="${e[t]}"]`);o&&(o.checked=!0)}else o.value=e[t]})}static escapeHtml(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,t=>e[t])}static unescapeHtml(t){const e={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return t.replace(/&amp;|&lt;|&gt;|&quot;|&#039;/g,t=>e[t])}static async copyToClipboard(t){try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(t),!0;{const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();try{return document.execCommand("copy"),!0}catch(t){return console.error("复制失败:",t),!1}finally{e.remove()}}}catch(t){return console.error("复制到剪贴板失败:",t),!1}}static formatBytes(t,e=2){if(0===t)return"0 Bytes";const r=e<0?0:e,o=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,o)).toFixed(r))+" "+["Bytes","KB","MB","GB","TB","PB"][o]}static formatDate(t,e="YYYY-MM-DD HH:mm:ss"){const r=new Date(t),o=r.getFullYear(),n=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0"),s=String(r.getHours()).padStart(2,"0"),i=String(r.getMinutes()).padStart(2,"0"),c=String(r.getSeconds()).padStart(2,"0");return e.replace("YYYY",o).replace("MM",n).replace("DD",a).replace("HH",s).replace("mm",i).replace("ss",c)}static formatRelativeTime(t){const e=new Date,r=new Date(t),o=e-r,n=Math.floor(o/1e3),a=Math.floor(n/60),s=Math.floor(a/60),i=Math.floor(s/24);return n<60?"刚刚":a<60?`${a}分钟前`:s<24?`${s}小时前`:i<30?`${i}天前`:this.formatDate(r,"YYYY-MM-DD")}static generateId(t="id"){return`${t}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}static deepClone(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array)return t.map(t=>this.deepClone(t));if(t instanceof Object){const e={};for(const r in t)t.hasOwnProperty(r)&&(e[r]=this.deepClone(t[r]));return e}}static isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}static isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0}static getUrlParams(){const t={},e=new URLSearchParams(window.location.search);for(const[r,o]of e)t[r]=o;return t}static setUrlParam(t,e){const r=new URL(window.location);r.searchParams.set(t,e),window.history.pushState({},"",r)}static removeUrlParam(t){const e=new URL(window.location);e.searchParams.delete(t),window.history.pushState({},"",e)}static waitForElement(t,e=5e3){return new Promise((r,o)=>{const n=document.querySelector(t);if(n)return void r(n);const a=new MutationObserver((e,o)=>{const n=document.querySelector(t);n&&(o.disconnect(),r(n))});a.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{a.disconnect(),o(new Error(`Element ${t} not found within ${e}ms`))},e)})}static scrollToElement(t,e={}){t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest",...e})}static downloadFile(t,e,r="text/plain"){const o=new Blob([t],{type:r}),n=URL.createObjectURL(o),a=document.createElement("a");a.href=n,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}static readFile(t,e=!0){return new Promise((r,o)=>{const n=new FileReader;n.onload=t=>r(t.target.result),n.onerror=o,e?n.readAsText(t):n.readAsDataURL(t)})}static sleep(t){return new Promise(e=>setTimeout(e,t))}static async retry(t,e=3,r=1e3){try{return await t()}catch(o){if(0===e)throw o;return await this.sleep(r),this.retry(t,e-1,2*r)}}static async batchPromises(t,e=5){const r=[];for(let o=0;o<t.length;o+=e){const n=t.slice(o,o+e),a=await Promise.all(n);r.push(...a)}return r}static createEventEmitter(){const t={};return{on(e,r){t[e]||(t[e]=[]),t[e].push(r)},off(e,r){t[e]&&(t[e]=t[e].filter(t=>t!==r))},emit(e,...r){t[e]&&t[e].forEach(t=>t(...r))},once(t,e){const r=(...o)=>{e(...o),this.off(t,r)};this.on(t,r)}}}}