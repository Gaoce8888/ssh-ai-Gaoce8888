export class UIManager{constructor(){this.sidebar=null,this.aiChat=null,this.notificationQueue=[],this.isProcessingNotification=!1}async init(){this.sidebar=document.getElementById("sidebar"),this.aiChat=document.getElementById("ai-chat"),this.restoreUIState(),this.initTheme(),console.log("UI管理器初始化完成")}toggleSidebar(){if(!this.sidebar)return;const t=this.sidebar.classList.toggle("collapsed");localStorage.setItem("sidebarCollapsed",t),window.dispatchEvent(new Event("resize")),this.isMobile()&&!t&&this.collapseChat()}showSidebar(){this.sidebar&&(this.sidebar.classList.remove("collapsed"),localStorage.setItem("sidebarCollapsed",!1))}hideSidebar(){this.sidebar&&(this.sidebar.classList.add("collapsed"),localStorage.setItem("sidebarCollapsed",!0))}toggleChat(){if(!this.aiChat)return;const t=this.aiChat.classList.toggle("collapsed"),e=document.getElementById("chat-toggle");e&&(e.textContent=t?"▲":"▼"),localStorage.setItem("chatCollapsed",t),this.isMobile()&&!t&&this.hideSidebar()}expandChat(){if(this.aiChat){this.aiChat.classList.remove("collapsed");const t=document.getElementById("chat-toggle");t&&(t.textContent="▼"),localStorage.setItem("chatCollapsed",!1)}}collapseChat(){if(this.aiChat){this.aiChat.classList.add("collapsed");const t=document.getElementById("chat-toggle");t&&(t.textContent="▲"),localStorage.setItem("chatCollapsed",!0)}}switchTab(t){document.querySelectorAll(".nav-tab").forEach(e=>{e.dataset.tab===t?(e.classList.add("active"),e.setAttribute("aria-selected","true")):(e.classList.remove("active"),e.setAttribute("aria-selected","false"))});document.querySelectorAll(".tab-content").forEach(e=>{e.id===`${t}-tab`?e.classList.add("active"):e.classList.remove("active")}),localStorage.setItem("activeTab",t)}showNotification(t,e="info",n=3e3){const i={id:Date.now(),message:t,type:e,duration:n};this.notificationQueue.push(i),this.isProcessingNotification||this.processNotificationQueue()}async processNotificationQueue(){if(0===this.notificationQueue.length)return void(this.isProcessingNotification=!1);this.isProcessingNotification=!0;const t=this.notificationQueue.shift(),e=this.createNotificationElement(t);document.body.appendChild(e),setTimeout(()=>{e.classList.add("show")},10),setTimeout(()=>{e.classList.remove("show"),setTimeout(()=>{e.remove(),this.processNotificationQueue()},300)},t.duration)}createNotificationElement(t){const e=document.createElement("div");e.className=`notification notification-${t.type}`,e.id=`notification-${t.id}`,e.style.cssText=`\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            padding: 12px 20px;\n            background: ${this.getNotificationColor(t.type)};\n            color: white;\n            border-radius: 8px;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n            z-index: 9999;\n            max-width: 350px;\n            transform: translateX(400px);\n            transition: transform 0.3s ease;\n            font-size: 14px;\n        `;const n=document.createElement("button");return n.innerHTML="×",n.style.cssText="\n            position: absolute;\n            top: 4px;\n            right: 8px;\n            background: none;\n            border: none;\n            color: white;\n            font-size: 20px;\n            cursor: pointer;\n            opacity: 0.8;\n        ",n.onclick=()=>{e.classList.remove("show"),setTimeout(()=>e.remove(),300)},e.textContent=t.message,e.appendChild(n),e.classList.add("notification-enter"),e}getNotificationColor(t){const e={success:"#4ade80",error:"#ef4444",warning:"#f59e0b",info:"#3b82f6"};return e[t]||e.info}initTheme(){const t=localStorage.getItem("theme")||"dark";this.setTheme(t)}setTheme(t){document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t)}toggleTheme(){const t="dark"===document.documentElement.getAttribute("data-theme")?"light":"dark";this.setTheme(t)}restoreUIState(){"true"===localStorage.getItem("sidebarCollapsed")&&this.hideSidebar();"false"!==localStorage.getItem("chatCollapsed")&&this.collapseChat();const t=localStorage.getItem("activeTab")||"ssh";this.switchTab(t)}isMobile(){return window.innerWidth<=768}isTablet(){return window.innerWidth>768&&window.innerWidth<=1024}isDesktop(){return window.innerWidth>1024}toggleFullscreen(){document.fullscreenElement?document.exitFullscreen().catch(t=>{console.error("无法退出全屏模式:",t)}):document.documentElement.requestFullscreen().catch(t=>{console.error("无法进入全屏模式:",t)})}showLoading(t="加载中..."){const e=document.createElement("div");e.id="global-loading",e.style.cssText="\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            background: rgba(0, 0, 0, 0.8);\n            color: white;\n            padding: 20px 40px;\n            border-radius: 8px;\n            z-index: 10000;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        ",e.innerHTML=`\n            <div class="loading-spinner" style="\n                width: 20px;\n                height: 20px;\n                border: 2px solid #ffffff40;\n                border-top-color: white;\n                border-radius: 50%;\n                animation: spin 1s linear infinite;\n            "></div>\n            <span>${t}</span>\n        `,document.body.appendChild(e)}hideLoading(){const t=document.getElementById("global-loading");t&&t.remove()}async confirm(t,e="确认"){return new Promise(n=>{const i=document.createElement("div");i.style.cssText="\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.5);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 10000;\n            ",i.innerHTML=`\n                <div style="\n                    background: var(--bg-secondary);\n                    padding: 24px;\n                    border-radius: 8px;\n                    max-width: 400px;\n                    width: 90%;\n                ">\n                    <h3 style="margin-bottom: 16px; color: var(--text-primary);">${e}</h3>\n                    <p style="margin-bottom: 24px; color: var(--text-secondary);">${t}</p>\n                    <div style="display: flex; gap: 12px; justify-content: flex-end;">\n                        <button class="btn btn-secondary" onclick="this.closest('div').remove(); window.uiConfirmResolve(false);">取消</button>\n                        <button class="btn btn-primary" onclick="this.closest('div').remove(); window.uiConfirmResolve(true);">确认</button>\n                    </div>\n                </div>\n            `,window.uiConfirmResolve=n,document.body.appendChild(i)})}}const style=document.createElement("style");style.textContent="\n.notification.show {\n    transform: translateX(0) !important;\n}\n\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n\n@media (max-width: 768px) {\n    .notification {\n        right: 10px !important;\n        left: 10px !important;\n        max-width: none !important;\n    }\n}\n",document.head.appendChild(style);