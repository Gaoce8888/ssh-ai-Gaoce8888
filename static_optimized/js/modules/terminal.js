export class TerminalManager{constructor(t){this.elementId=t,this.terminal=null,this.fitAddon=null,this.webLinksAddon=null,this.searchAddon=null,this.isInitialized=!1}async init(){try{await this.waitForXterm(),this.terminal=new Terminal({fontSize:14,fontFamily:'Consolas, Monaco, "Courier New", monospace',cursorBlink:!0,cursorStyle:"block",bellStyle:"none",scrollback:1e4,tabStopWidth:4,theme:{background:"#000000",foreground:"#ffffff",cursor:"#4a9eff",cursorAccent:"#000000",selection:"rgba(74, 158, 255, 0.3)",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#ffffff"}}),this.fitAddon=new FitAddon.FitAddon,this.terminal.loadAddon(this.fitAddon);const t=document.getElementById(this.elementId);if(!t)throw new Error(`找不到元素: ${this.elementId}`);this.terminal.open(t),this.fit(),this.setupResizeObserver(),this.isInitialized=!0,console.log("终端初始化成功")}catch(t){throw console.error("终端初始化失败:",t),t}}waitForXterm(){return new Promise((t,e)=>{let i=0;const n=()=>{"undefined"!=typeof Terminal&&"undefined"!=typeof FitAddon?t():i>=50?e(new Error("xterm.js 加载超时")):(i++,setTimeout(n,100))};n()})}setupResizeObserver(){if("ResizeObserver"in window){const t=document.getElementById(this.elementId).parentElement;new ResizeObserver(()=>{this.fit()}).observe(t)}}fit(){if(this.fitAddon&&this.isInitialized)try{this.fitAddon.fit()}catch(t){console.error("调整终端大小失败:",t)}}write(t){this.terminal&&this.terminal.write(t)}writeln(t){this.terminal&&this.terminal.writeln(t)}clear(){this.terminal&&this.terminal.clear()}focus(){this.terminal&&this.terminal.focus()}blur(){this.terminal&&this.terminal.blur()}onData(t){if(this.terminal)return this.terminal.onData(t)}onResize(t){if(this.terminal)return this.terminal.onResize(t)}getSize(){return this.terminal?{cols:this.terminal.cols,rows:this.terminal.rows}:{cols:80,rows:24}}setOption(t,e){this.terminal&&this.terminal.setOption(t,e)}getOption(t){return this.terminal?this.terminal.getOption(t):null}scrollToBottom(){this.terminal&&this.terminal.scrollToBottom()}scrollToTop(){this.terminal&&this.terminal.scrollToTop()}selectAll(){this.terminal&&this.terminal.selectAll()}hasSelection(){return!!this.terminal&&this.terminal.hasSelection()}getSelection(){return this.terminal?this.terminal.getSelection():""}clearSelection(){this.terminal&&this.terminal.clearSelection()}dispose(){this.terminal&&(this.terminal.dispose(),this.terminal=null,this.fitAddon=null,this.isInitialized=!1)}}